<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>camera</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openGallery()">
        <ion-img src="https://iili.io/Ff9Dgwl.png" style="width: 24px; height: 24px;"></ion-img>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Modo Câmera Padrão -->
  <div *ngIf="!isARMode" class="video-container">
    <video id="video" autoplay playsinline [class.black-and-white]="isBlackAndWhite"></video>
  </div>

  <!-- Modo AR com A-Frame e AR.js -->
  <a-scene *ngIf="isARMode" embedded arjs="sourceType: webcam; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    physics="driver: cannon; gravity: -9.8">
    <a-assets>
      <a-asset-item id="cup-obj" src="assets/copoModel/copo/copo.obj"></a-asset-item>
      <a-asset-item id="cup-mtl" src="assets/copoModel/copo/copo.mtl"></a-asset-item>
    </a-assets>
    <a-marker preset="hiro">
      <a-entity id="cup" obj-model="obj: #cup-obj; mtl: #cup-mtl" scale="0.1 0.1 0.1"
        physics="type: dynamic; mass: 1; shape: box"></a-entity>
    </a-marker>
    <!-- Plano virtual para colisão -->
    <a-entity id="floor" geometry="primitive: plane; width: 10; height: 10" position="0 -0.5 0" rotation="-90 0 0"
      material="opacity: 0.5; transparent: true" physics="type: static; shape: box"></a-entity>
    <a-entity camera></a-entity>
  </a-scene>

  <!-- Controles -->
  <ion-button (click)="startCamera()" *ngIf="!isARMode">Iniciar Câmera</ion-button>
  <ion-button (click)="stopCamera()" *ngIf="!isARMode">Parar Câmera</ion-button>
  <ion-button (click)="toggleCamera()" *ngIf="!isARMode">Trocar para {{ facingMode === 'user' ? 'Câmera Traseira' :
    'Selfie' }}</ion-button>
  <ion-button (click)="toggleBlackAndWhite()" *ngIf="!isARMode">Filtro {{ isBlackAndWhite ? 'Colorido' : 'Preto e Branco' }}</ion-button>
  <ion-button color="warning" (click)="takePhoto()" *ngIf="!isARMode">Tirar foto</ion-button>
  <ion-item *ngIf="!isARMode">
    <ion-label>Qualidade do Vídeo</ion-label>
    <ion-select [(ngModel)]="videoQuality" (ionChange)="changeQuality()">
      <ion-select-option value="low">Baixa (480p)</ion-select-option>
      <ion-select-option value="medium">Média (720p)</ion-select-option>
      <ion-select-option value="high">Alta (1080p)</ion-select-option>
    </ion-select>
  </ion-item>
  <ion-button class="iniciarar" (click)="Iniciarar()">Iniciar AR</ion-button>
</ion-content>

<ion-modal id="gallery-modal" [isOpen]="isGalleryOpen" (didDismiss)="isGalleryOpen = false">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Galeria</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeGallery()">Fechar</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-list>
        <ion-item *ngFor="let photo of photos; let i = index">
          <ion-thumbnail slot="start">
            <img [src]="photo" />
          </ion-thumbnail>
          <ion-button (click)="savePhoto(i)">Salvar imagem</ion-button>
          <ion-button (click)="copyPhoto(i)">Copiar imagem</ion-button>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Scripts para A-Frame, AR.js e Física -->
<script src="assets/cannon.min.js"></script>
<script src="assets/aframe.min.js"></script>
<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="assets/aframe-extras.min.js"></script>
